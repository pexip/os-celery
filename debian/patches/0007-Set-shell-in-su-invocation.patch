From 8af58d646c13cbd52374f855d522f48b580b3089 Mon Sep 17 00:00:00 2001
From: Brian May <bam@debian.org>
Date: Wed, 25 May 2016 18:06:17 +1000
Subject: Set shell in su invocation

See Bug#824786: celeryd: Initscript doesn't start daemon,
http://bugs.debian.org/824786
---
 extra/generic-init.d/celerybeat | 2 +-
 extra/generic-init.d/celeryd    | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/extra/generic-init.d/celerybeat b/extra/generic-init.d/celerybeat
index b6287ad..78aa25a 100755
--- a/extra/generic-init.d/celerybeat
+++ b/extra/generic-init.d/celerybeat
@@ -249,7 +249,7 @@ stop_beat () {
 }
 
 _chuid () {
-    su "$CELERYBEAT_USER" -c "$CELERYBEAT $*"
+    su "$CELERYBEAT_USER" --shell=/bin/sh -c "$CELERYBEAT $*"
 }
 
 start_beat () {
diff --git a/extra/generic-init.d/celeryd b/extra/generic-init.d/celeryd
index 6c2f866..7ad4599 100755
--- a/extra/generic-init.d/celeryd
+++ b/extra/generic-init.d/celeryd
@@ -241,7 +241,7 @@ _get_pids() {
 
 
 _chuid () {
-    su "$CELERYD_USER" -c "$CELERYD_MULTI $*"
+    su "$CELERYD_USER" --shell=/bin/sh -c "$CELERYD_MULTI $*"
 }
 
 
